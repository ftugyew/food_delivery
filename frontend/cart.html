<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Tindo Cart â€“ Mana Tindi, Mana App</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="css/animations.css">
  <link rel="stylesheet" href="css/responsive.css">
  <script src="js/auth-guard.js" defer></script>
  <script src="js/wish.js" defer></script>
  <style>
    .cart-item-modern {
      background: white;
      border-radius: 16px;
      padding: 1rem;
      margin-bottom: 1rem;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
      transition: all 0.3s ease;
    }
    .cart-item-modern:hover {
      box-shadow: 0 4px 16px rgba(0, 0, 0, 0.12);
      transform: translateY(-2px);
    }
    .quantity-btn {
      width: 36px;
      height: 36px;
      border-radius: 8px;
      border: 1px solid #e5e7eb;
      background: white;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.25rem;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s ease;
    }
    .quantity-btn:hover {
      background: #f3f4f6;
      border-color: #10b981;
    }
    .quantity-btn:active {
      transform: scale(0.95);
    }
    @media (max-width: 640px) {
      .cart-item-modern {
        padding: 0.75rem;
      }
    }
  </style>
</head>
<body class="bg-gray-50 text-gray-800 font-sans pb-20 md:pb-0">

  <!-- Modern Sticky Header -->
  <header class="sticky-header bg-white border-b border-gray-200">
    <div class="max-w-6xl mx-auto px-4 md:px-6 py-4">
      <div class="flex items-center justify-between">
        <div class="flex items-center gap-3">
          <a href="index.html" class="text-gray-600 hover:text-green-600 transition" aria-label="Go back to home">
            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path>
            </svg>
          </a>
          <h1 class="text-2xl md:text-3xl font-bold bg-gradient-to-r from-green-600 to-green-700 bg-clip-text text-transparent">
            ðŸ›’ My Cart
          </h1>
        </div>
        <a href="index.html" class="hidden md:flex items-center gap-2 text-green-600 hover:text-green-700 font-semibold transition">
          <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 11V7a4 4 0 00-8 0v4M5 9h14l1 12H4L5 9z"></path>
          </svg>
          Continue Shopping
        </a>
      </div>
    </div>
  </header>

  <!-- Cart Section -->
  <main class="max-w-6xl mx-auto px-4 md:px-6 py-6 md:py-8">
    <!-- Empty Cart -->
    <div id="empty-cart" class="hidden">
      <div class="bg-white rounded-2xl shadow-lg p-8 md:p-12 text-center">
        <div class="w-32 h-32 mx-auto mb-6 bg-gray-100 rounded-full flex items-center justify-center">
          <svg class="w-16 h-16 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 11V7a4 4 0 00-8 0v4M5 9h14l1 12H4L5 9z"></path>
          </svg>
        </div>
        <h2 class="text-2xl md:text-3xl font-bold text-gray-800 mb-3">Your cart is empty</h2>
        <p class="text-gray-500 mb-6">Looks like you haven't added anything to your cart yet</p>
        <a href="index.html" class="inline-flex items-center gap-2 btn-modern btn-modern-primary">
          <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 11V7a4 4 0 00-8 0v4M5 9h14l1 12H4L5 9z"></path>
          </svg>
          Browse Restaurants
        </a>
      </div>
    </div>

    <!-- Cart with Items -->
    <div id="cart-content" class="hidden">
      <div class="grid lg:grid-cols-3 gap-6">
        <!-- Cart Items -->
        <div class="lg:col-span-2">
          <div class="bg-white rounded-2xl shadow-lg p-4 md:p-6 mb-4">
            <h2 class="text-xl md:text-2xl font-bold text-gray-800 mb-6">Your Selected Dishes</h2>
            <div id="cart-items" class="space-y-4"></div>
          </div>
        </div>

        <!-- Order Summary (Sticky on Desktop) -->
        <div class="lg:col-span-1">
          <div class="lg:sticky lg:top-24">
            <div id="cart-summary" class="bg-white rounded-2xl shadow-lg p-6 border border-gray-100">
              <h3 class="text-lg font-bold text-gray-800 mb-4">Order Summary</h3>
              
              <div class="space-y-3 mb-4">
                <div class="flex justify-between text-gray-600">
                  <span>Subtotal</span>
                  <span id="subtotal" class="font-semibold text-gray-800">â‚¹0</span>
                </div>
                <div class="flex justify-between text-gray-600">
                  <span>Delivery Fee</span>
                  <span id="delivery" class="font-semibold text-green-600">â‚¹30</span>
                </div>
                <div class="border-t border-gray-200 pt-3 mt-3">
                  <div class="flex justify-between text-xl font-bold">
                    <span>Total</span>
                    <span id="total" class="text-green-600">â‚¹0</span>
                  </div>
                </div>
              </div>

              <button id="proceed-btn" class="w-full btn-modern btn-modern-primary mb-3" data-wish>
                <span class="flex items-center justify-center gap-2">
                  <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 10h18M7 15h1m4 0h1m-7 4h12a3 3 0 003-3V8a3 3 0 00-3-3H6a3 3 0 00-3 3v8a3 3 0 003 3z"></path>
                  </svg>
                  Proceed to Payment
                </span>
              </button>
              <button id="clear-cart" class="w-full py-3 border-2 border-gray-300 text-gray-700 rounded-xl font-semibold hover:bg-gray-50 transition" data-wish>
                Clear Cart
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </main>

  <!-- Mobile Bottom Navigation -->
  <nav class="mobile-bottom-nav safe-area-bottom">
    <a href="index.html" class="mobile-nav-item">
      <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6"></path>
      </svg>
      <span>Home</span>
    </a>
    <a href="restaurants.html" class="mobile-nav-item">
      <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4"></path>
      </svg>
      <span>Restaurants</span>
    </a>
    <a href="cart.html" class="mobile-nav-item active">
      <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 11V7a4 4 0 00-8 0v4M5 9h14l1 12H4L5 9z"></path>
      </svg>
      <span>Cart</span>
    </a>
    <a href="login.html" class="mobile-nav-item">
      <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path>
      </svg>
      <span>Profile</span>
    </a>
  </nav>

  <script>
    const API_BASE_URL = window.API_BASE_URL || "https://food-delivery-backend-cw3m.onrender.com/api";
    // Load cart items from localStorage
    const cartItemsContainer = document.getElementById('cart-items');
    const subtotalEl = document.getElementById('subtotal');
    const totalEl = document.getElementById('total');
    const emptyCart = document.getElementById('empty-cart');
    const summary = document.getElementById('cart-summary');
    const deliveryFee = 30;

    let cart = JSON.parse(localStorage.getItem('tindo_cart')) || [];

    function renderCart() {
      cartItemsContainer.innerHTML = '';

      if (cart.length === 0) {
        emptyCart.classList.remove('hidden');
        document.getElementById('cart-content')?.classList.add('hidden');
        return;
      }

      emptyCart.classList.add('hidden');
      const cartContent = document.getElementById('cart-content');
      if (cartContent) {
        cartContent.classList.remove('hidden');
      }
      summary?.classList.remove('hidden');

      let subtotal = 0;

      cart.forEach((item, index) => {
        subtotal += item.price * item.qty;

        const cartItem = document.createElement('div');
        cartItem.className = 'cart-item-modern';
        const cartItemImage = (item.image_url && item.image_url.startsWith('http')) ? item.image_url : '/assets/placeholder.jpg';
        cartItem.innerHTML = `
          <div class="flex items-center gap-4">
            <div class="relative flex-shrink-0">
              <img src="${cartItemImage}" alt="${item.name}" class="w-20 h-20 md:w-24 md:h-24 rounded-xl object-cover border-2 border-gray-100"
                   onerror="this.src='/assets/placeholder.jpg'">
              <div class="absolute -top-2 -right-2 bg-green-500 text-white text-xs font-bold rounded-full w-6 h-6 flex items-center justify-center">${item.qty}</div>
            </div>
            <div class="flex-1 min-w-0">
              <h3 class="text-base md:text-lg font-bold text-gray-800 mb-1 truncate">${item.name}</h3>
              <p class="text-sm text-gray-500 mb-2">â‚¹${item.price} per item</p>
              <div class="flex items-center gap-3">
                <div class="flex items-center gap-2 bg-gray-100 rounded-lg p-1">
                  <button onclick="updateQty(${index}, -1)" class="quantity-btn text-gray-600 hover:text-green-600">âˆ’</button>
                  <span class="font-semibold text-gray-800 min-w-[24px] text-center">${item.qty}</span>
                  <button onclick="updateQty(${index}, 1)" class="quantity-btn text-gray-600 hover:text-green-600">+</button>
                </div>
                <button onclick="removeItem(${index})" class="text-red-500 hover:text-red-700 p-2 hover:bg-red-50 rounded-lg transition" title="Remove item">
                  <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path>
                  </svg>
                </button>
              </div>
            </div>
            <div class="text-right">
              <p class="text-lg md:text-xl font-bold text-gray-800">â‚¹${item.price * item.qty}</p>
            </div>
          </div>
        `;
        cartItemsContainer.appendChild(cartItem);
      });

      subtotalEl.textContent = `â‚¹${subtotal}`;
      totalEl.textContent = `â‚¹${subtotal + deliveryFee}`;
    }

    function updateQty(index, change) {
      cart[index].qty += change;
      if (cart[index].qty <= 0) removeItem(index);
      localStorage.setItem('tindo_cart', JSON.stringify(cart));
      renderCart();
    }

    function removeItem(index) {
      cart.splice(index, 1);
      localStorage.setItem('tindo_cart', JSON.stringify(cart));
      renderCart();
    }

    document.getElementById('clear-cart').addEventListener('click', () => {
      localStorage.removeItem('tindo_cart');
      cart = [];
      renderCart();
    });

    // âœ… Proceed to payment â€” save cart to unified format for backend
    document.getElementById('proceed-btn').addEventListener('click', () => {
      if (cart.length === 0) {
        alert("Your cart is empty!");
        return;
      }

      // Save Tindo cart as global format for backend
      const restaurantId = cart[0]?.restaurant_id || 1; // fallback to 1
      localStorage.setItem("cartItems", JSON.stringify(cart));
      localStorage.setItem("selectedRestaurantId", restaurantId);

      alert("âœ… Cart saved successfully. Proceeding to address...");
      window.location.href = 'user-address.html';
    });

    renderCart();
  </script>

</body>
</html>
